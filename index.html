<script>
  const clubesURL = "https://globopedia.github.io/Rivales-Huracan/clubes.csv";
  const partidosURL = "https://globopedia.github.io/Rivales-Huracan/Encuentros_Huracan.csv";
  let clubes = [];
  let Encuentros_Huracan = [];

  Promise.all([
    fetch(clubesURL).then(r => r.text()),
    fetch(partidosURL).then(r => r.text())
  ]).then(([csvClubes, csvEncuentros_Huracan]) => {
    clubes = Papa.parse(csvClubes, { header: true, skipEmptyLines: true }).data.map(c => ({
      id: c.id?.trim(),
      club: c.Club?.trim() || c.club?.trim(),
      nombre: c.Nombre || c.nombre || "",
      fundacion: c.Fundacion || c.fundacion || "",
      direccion: c.Direccion || c.direccion || "",
      titulos: c.Titulos || c.titulos || "",
      estadio: c.Estadio || c.estadio || "",
      detalle: c.Detalle || c.detalle || "",
      escudo: c.Escudo || c.escudo || ""
    }));

    Encuentros_Huracan = Papa.parse(csvEncuentros_Huracan, { header: true, skipEmptyLines: true }).data.map(p => ({
      detalle: p.detalle || p.Detalle || Object.values(p)[0] || ""
    }));

    console.log("Clubes cargados:", clubes);
    console.log("Encuentros cargados:", Encuentros_Huracan);

    llenarSelectClubes();
  });

  function llenarSelectClubes() {
    const select = document.getElementById("clubSelect");
    select.innerHTML = `<option value="">-- Seleccionar --</option>`;
    clubes.forEach(club => {
      if (club.id && club.club) {
        const opt = document.createElement("option");
        opt.value = club.id;
        opt.textContent = club.club;
        select.appendChild(opt);
      }
    });
    select.addEventListener("change", mostrarClub);
  }

  function mostrarClub() {
    const clubId = document.getElementById("clubSelect").value;
    const club = clubes.find(c => String(c.id).trim() === clubId.trim());
    if (!club) { alert("No se encontr√≥ el club seleccionado"); return; }

    const cont = document.getElementById("clubInfo");
    cont.style.display = "block";
    cont.innerHTML = `
      <div class="club-header">
        <img src="${club.escudo}" alt="escudo" />
        <h2>${club.nombre}</h2>
      </div>
      <p><b>Fundaci√≥n:</b> ${club.fundacion}</p>
      <p><b>Direcci√≥n:</b> ${club.direccion}</p>
      <p><b>T√≠tulos:</b> ${club.titulos}</p>
      <p><b>Estadio:</b> ${club.estadio}</p>
      <p><b>Detalle:</b> ${club.detalle}</p>
      <div class="stats"><h3 style="color:#FF0000;">üìä Estad√≠sticas</h3>${generarEstadisticas(club.club.trim())}</div>
    `;
  }

  function normalizarTexto(texto) {
    return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  }

  function generarEstadisticas(nombreClub) {
    const competencias = [
      "Copa Libertadores",
      "Copa Sudamericana",
      "Campeonato",
      "Copa Argentina",
      "Supercopa",
      "Copa Superliga",
      "Copa Maradona",
      "Nacional B",
      "Amistoso"
    ];

    const condiciones = ["local", "neutral", "visitante"];
    const resultados = ["Victoria", "Empate", "Derrota"];

    let html = "";

    competencias.forEach(comp => {
      let compHTML = "";

      condiciones.forEach(cond => {
        let linea = "";

        resultados.forEach(res => {
          const coincidencias = Encuentros_Huracan.filter(p => {
            if (!p.detalle) return false;

            const detalleNormalizado = normalizarTexto(p.detalle);

            const tieneClub = detalleNormalizado.includes(normalizarTexto(nombreClub));
            const tieneComp = detalleNormalizado.includes(normalizarTexto(comp));
            const tieneRes = detalleNormalizado.includes(normalizarTexto(res));
            const tieneCond = detalleNormalizado.includes(normalizarTexto(cond));

            if (tieneClub && tieneComp) {
              console.log(`üîç [${comp}] ${res} ${cond} ‚Üí`, p.detalle.slice(0, 100));
              console.log("Club?", tieneClub, "| Comp?", tieneComp, "| Res?", tieneRes, "| Cond?", tieneCond);
            }

            return tieneClub && tieneComp && tieneRes && tieneCond;
          }).length;

          if (coincidencias > 0) {
            linea += `${coincidencias} ${coincidencias === 1 ? "partido" : "partidos"} ${res} | `;
          }
        });

        if (linea) {
          compHTML += `<p>‚úÖ ${cond}: ${linea.slice(0, -3)}</p>`;
        }
      });

      if (compHTML) {
        html += `<div class="stat-group">
                   <div class="stat-title">üèÜ ${comp}</div>
                   ${compHTML}
                 </div>`;
      }
    });

    return html || "<p>Sin datos disponibles</p>";
  }
</script>
