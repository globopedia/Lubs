<script>
    const clubesURL = "https://globopedia.github.io/Rivales-Huracan/clubes.csv?v=" + new Date().getTime();
    const partidosURL = "https://globopedia.github.io/buscador-partidos/Encuentros_Huracan.csv";
    let clubes = [];
    let Encuentros_Huracan = [];

    Promise.all([
      fetch(clubesURL).then(r => r.text()),
      fetch(partidosURL).then(r => r.text())
    ]).then(([csvClubes, csvEncuentros_Huracan]) => {
      clubes = Papa.parse(csvClubes, { header: true, skipEmptyLines: true }).data.map(c => ({
        id: c.id?.trim(),
        club: c.Club?.trim() || c.club?.trim(),
        nombre: c.Nombre || c.nombre || "",
        fundacion: c.Fundacion || c.fundacion || "",
        direccion: c.Direccion || c.direccion || "",
        web: c.Web || c.web || "",
        colores: c.Colores || c.colores || "",
        titulos: c.Titulos || c.titulos || "",
        estadio: c.Estadio || c.estadio || "",
        curiosidades: c.Curiosidades || c.curiosidades || "",
        escudo: c.Escudo || c.escudo || ""
      }));

      // Guardamos m√°s campos del CSV
      Encuentros_Huracan = Papa.parse(csvEncuentros_Huracan, { header: true, skipEmptyLines: true }).data.map(p => ({
        detalle: p.detalle || p.Detalle || "",
        competencia: p.competencia || p.Competencia || "",
        condicion: p.condicion || p.Condicion || "", // Local / Visitante / Neutral
        resultado: p.resultado || p.Resultado || ""
      }));

      llenarSelectClubes();
    });

    function llenarSelectClubes() {
      const select = document.getElementById("clubSelect");
      select.innerHTML = `<option value="">-- Seleccionar --</option>`;
      clubes.forEach(club => {
        if (club.id && club.club) {
          const opt = document.createElement("option");
          opt.value = club.id;
          opt.textContent = club.club;
          select.appendChild(opt);
        }
      });
      select.addEventListener("change", mostrarClub);
    }

    function mostrarClub() {
      const clubId = document.getElementById("clubSelect").value;
      const club = clubes.find(c => String(c.id).trim() === clubId.trim());
      if (!club) { alert("No se encontr√≥ el club seleccionado"); return; }

      const cont = document.getElementById("clubInfo");
      cont.style.display = "block";
      cont.innerHTML = `
        <div class="club-header">
          <img src="${club.escudo}" alt="escudo" />
          <h2>${club.nombre}</h2>
        </div>
        <p><b>Fundaci√≥n:</b> ${club.fundacion}</p>
        <p><b>Direcci√≥n:</b> ${club.direccion}</p>
        <p><b>Web:</b> ${club.web}</p>
        <p><b>Colores:</b> ${club.colores}</p>
        <p><b>T√≠tulos:</b> ${club.titulos}</p>
        <p><b>Estadio:</b> ${club.estadio}</p>
        <p><b>Curiosidades:</b> ${club.curiosidades}</p>
        <div class="stats"><h3 style="color:#FF0000;">üìä Estad√≠sticas</h3>${generarEstadisticas(club.club.trim())}</div>
      `;
    }

    function normalizarTexto(texto) {
      return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    function generarEstadisticas(nombreClub) {
      const competencias = [
        "Copa Libertadores",
        "Copa Sudamericana",
        "Campeonato",
        "Copa Argentina",
        "Copa Superliga",
        "Copa Maradona",
        "Supercopa",
        "Nacional B",
        "Amistoso"
      ];

      const condiciones = ["Local", "Visitante", "Neutral"];

      let html = "";

      competencias.forEach(comp => {
        let compHTML = `<div class="stat-group"><div class="stat-title">üèÜ ${comp}</div>`;

        condiciones.forEach(cond => {
          let victorias = 0, empates = 0, derrotas = 0;

          Encuentros_Huracan.forEach(p => {
            if (
              normalizarTexto(p.competencia) === normalizarTexto(comp) &&
              normalizarTexto(p.condicion) === normalizarTexto(cond) &&
              normalizarTexto(p.detalle).includes(normalizarTexto(nombreClub))
            ) {
              if (normalizarTexto(p.resultado) === "victoria") victorias++;
              else if (normalizarTexto(p.resultado) === "empate") empates++;
              else if (normalizarTexto(p.resultado) === "derrota") derrotas++;
            }
          });

          if (victorias + empates + derrotas > 0) {
            compHTML += `<p><b>${cond}:</b> ‚úÖ ${victorias} | ü§ù ${empates} | ‚ùå ${derrotas}</p>`;
          }
        });

        compHTML += `</div>`;
        if (!/Local|Visitante|Neutral/.test(compHTML)) {
          // No hubo datos para esta competencia
        } else {
          html += compHTML;
        }
      });

      return html || "<p>Sin datos disponibles</p>";
    }
</script>
